# 🔗 Acortador de URLs

Sistema profesional de acortamiento de URLs con panel de administración, gestión de usuarios y estadísticas detalladas.

## ✨ Características

- **🔗 Acortamiento de URLs** - Genera códigos cortos únicos de 6 caracteres
- **👥 Sistema de Usuarios** - Login con roles (admin/usuario)
- **📊 Panel de Administración** - Gestión completa del sistema
- **📈 Estadísticas Detalladas** - Clicks, origen, navegadores, países
- **🗺️ Geolocalización** - Tracking de ubicación de visitantes
- **🎨 Diseño Responsivo** - Interfaz moderna y adaptable
- **🔒 Seguridad** - Contraseñas hasheadas, sesiones seguras
- **⚡ Alto Rendimiento** - Optimizado para miles de URLs

## 📋 Requisitos

- PHP 7.4 o superior
- MySQL 5.7 o superior
- Apache/Nginx con mod_rewrite
- Extensiones PHP: PDO, PDO_MySQL

## 🚀 Instalación

### 1. Clonar o descargar el proyecto

```bash
cd /var/www/html
git clone [tu-repositorio] acortador
cd acortador
```

### 2. Crear la base de datos

```sql
CREATE DATABASE url_shortener CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE url_shortener;
```

### 3. Crear las tablas

```sql
-- Tabla de usuarios
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    full_name VARCHAR(100),
    role ENUM('admin', 'user') DEFAULT 'user',
    status ENUM('active', 'banned', 'pending') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP NULL,
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_status (status)
);

-- Tabla de URLs
CREATE TABLE urls (
    id INT AUTO_INCREMENT PRIMARY KEY,
    short_code VARCHAR(10) UNIQUE NOT NULL,
    original_url TEXT NOT NULL,
    clicks INT DEFAULT 0,
    user_id INT DEFAULT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_short_code (short_code),
    INDEX idx_user_id (user_id),
    INDEX idx_created_at (created_at),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
);

-- Tabla de estadísticas de clicks
CREATE TABLE click_stats (
    id INT AUTO_INCREMENT PRIMARY KEY,
    url_id INT NOT NULL,
    clicked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ip_address VARCHAR(45),
    user_agent TEXT,
    referer TEXT,
    country VARCHAR(100),
    city VARCHAR(100),
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    browser VARCHAR(50),
    platform VARCHAR(50),
    INDEX idx_url_id (url_id),
    INDEX idx_clicked_at (clicked_at),
    INDEX idx_country (country),
    FOREIGN KEY (url_id) REFERENCES urls(id) ON DELETE CASCADE
);

-- Crear usuario administrador inicial
INSERT INTO users (username, password, email, full_name, role, status) 
VALUES ('admin', '$2y$10$YourHashedPasswordHere', 'admin@tudominio.com', 'Administrador', 'admin', 'active');
```

### 4. Configurar el archivo conf.php

```php
<?php
// Configuración de base de datos
define('DB_HOST', 'localhost');
define('DB_NAME', 'url_shortener');
define('DB_USER', 'tu_usuario_mysql');
define('DB_PASS', 'tu_contraseña_mysql');

// URL base del acortador (IMPORTANTE: con / al final)
define('BASE_URL', 'https://tudominio.com/acortador/');

// Credenciales del super admin (usa conf.php en lugar de BD)
define('ADMIN_USERNAME', 'admin');
define('ADMIN_PASSWORD', 'admin123'); // CAMBIAR EN PRODUCCIÓN

// Configuración adicional
define('SHORT_URL_LENGTH', 6);
define('SESSION_LIFETIME', 3600); // 1 hora

// Función para generar código corto
function generateShortCode($length = 6) {
    $characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
    $charactersLength = strlen($characters);
    $randomString = '';
    for ($i = 0; $i < $length; $i++) {
        $randomString .= $characters[rand(0, $charactersLength - 1)];
    }
    return $randomString;
}
?>
```

### 5. Configurar .htaccess

```apache
RewriteEngine On

# Redirigir URLs cortas
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/acortador/admin
RewriteCond %{REQUEST_URI} !^/acortador/assets
RewriteRule ^([a-zA-Z0-9]+)$ redirect.php?code=$1 [L]

# Proteger archivos sensibles
<FilesMatch "\.(sql|log|ini)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Proteger conf.php
<Files "conf.php">
    Order allow,deny
    Deny from all
</Files>
```

### 6. Configurar permisos

```bash
# Ejecutar el script de permisos incluido
chmod +x fix_permissions.sh
./fix_permissions.sh
```

## 📁 Estructura del Proyecto

```
acortador/
├── index.php              # Página principal del acortador
├── redirect.php           # Maneja las redirecciones
├── stats.php             # Estadísticas públicas de URLs
├── conf.php              # Configuración (proteger este archivo)
├── menu.php              # Menú de navegación
├── .htaccess             # Reglas de reescritura
├── admin/
│   ├── login.php         # Login administrativo
│   ├── logout.php        # Cerrar sesión
│   ├── panel_simple.php  # Panel principal
│   ├── usuarios.php      # Gestión de usuarios
│   ├── stats.php         # Estadísticas detalladas
│   ├── mapa_simple.php   # Mapa de geolocalización
│   ├── generar_geo.php   # Generador de datos geo
│   └── ver_coordenadas.php # Visualizar coordenadas
├── assets/               # Recursos estáticos (CSS, JS, imágenes)
└── README.md            # Este archivo
```

## 🔧 Configuración Adicional

### Nginx (si no usas Apache)

```nginx
location /acortador {
    try_files $uri $uri/ @rewrite;
}

location @rewrite {
    rewrite ^/acortador/([a-zA-Z0-9]+)$ /acortador/redirect.php?code=$1 last;
}

location ~ /acortador/(conf\.php|\.sql|\.log) {
    deny all;
}
```

### Cron para limpieza (opcional)

```bash
# Limpiar estadísticas antiguas cada mes
0 0 1 * * cd /var/www/html/acortador && php -f cleanup_old_stats.php
```

## 👤 Uso

### Como Usuario

1. Accede a `https://tudominio.com/acortador/`
2. Pega tu URL larga
3. Haz clic en "Acortar"
4. Copia y comparte tu URL corta

### Como Administrador

1. Accede a `https://tudominio.com/acortador/admin/`
2. Ingresa con las credenciales configuradas en `conf.php`
3. Gestiona usuarios, URLs y visualiza estadísticas

## 🔒 Seguridad

- **Contraseñas**: Hasheadas con bcrypt
- **Sesiones**: Configuradas con tiempo de expiración
- **SQL Injection**: Prevenido con consultas preparadas
- **XSS**: Datos escapados con `htmlspecialchars()`
- **CSRF**: Tokens en formularios críticos
- **Archivos sensibles**: Protegidos vía .htaccess

## 📊 API de Estadísticas

Las estadísticas recopiladas incluyen:
- Número de clicks
- Ubicación geográfica (país, ciudad)
- Navegador y sistema operativo
- Referrer
- Fecha y hora

## 🛠️ Solución de Problemas

### Error 500
- Verifica los permisos de archivos
- Revisa los logs de Apache/Nginx

### URLs no se acortan
- Verifica que mod_rewrite esté habilitado
- Confirma que .htaccess se esté procesando

### No se puede login
- Verifica las credenciales en conf.php
- Asegúrate que la tabla users existe

## 📝 Licencia

Este proyecto es de código abierto. Úsalo como desees.

## 🤝 Contribuciones

Las contribuciones son bienvenidas. Por favor:
1. Fork el proyecto
2. Crea tu rama de características
3. Commit tus cambios
4. Push a la rama
5. Abre un Pull Request

## 📧 Soporte

Para soporte, abre un issue en el repositorio o contacta al administrador.

---

Desarrollado con ❤️ por [Verkoven]
